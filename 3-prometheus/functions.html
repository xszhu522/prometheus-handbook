<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.0" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.1" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://xszhu522.github.io/prometheus-handbook/3-prometheus/functions.html"><meta property="og:site_name" content="prometheus-handbook"><meta property="og:title" content="PromQL 内置函数"><meta property="og:description" content="Prometheus 提供了其它大量的内置函数，可以对时序数据进行丰富的处理。某些函数有默认的参数，例如：year(v=vector(time()) instant-vector)。其中参数 v 是一个瞬时向量，如果不提供该参数，将使用默认值 vector(time())。instant-vector 表示参数类型。 abs() abs(v insta..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-03-29T07:30:29.000Z"><meta property="article:author" content="xszhu522"><meta property="article:modified_time" content="2019-03-29T07:30:29.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"PromQL 内置函数","image":[""],"dateModified":"2019-03-29T07:30:29.000Z","author":[{"@type":"Person","name":"xszhu522","url":"https://xszhu522.github.io"}]}</script><link rel="icon" href="/prometheus-handbook/favicon.ico"><title>PromQL 内置函数 | prometheus-handbook</title><meta name="description" content="Prometheus 提供了其它大量的内置函数，可以对时序数据进行丰富的处理。某些函数有默认的参数，例如：year(v=vector(time()) instant-vector)。其中参数 v 是一个瞬时向量，如果不提供该参数，将使用默认值 vector(time())。instant-vector 表示参数类型。 abs() abs(v insta...">
    <link rel="preload" href="/prometheus-handbook/assets/style-Ke1aRPxq.css" as="style"><link rel="stylesheet" href="/prometheus-handbook/assets/style-Ke1aRPxq.css">
    <link rel="modulepreload" href="/prometheus-handbook/assets/app-aeozbcr_.js"><link rel="modulepreload" href="/prometheus-handbook/assets/functions.html-6Ecwbyyp.js"><link rel="modulepreload" href="/prometheus-handbook/assets/plugin-vue_export-helper-x3n3nnut.js"><link rel="modulepreload" href="/prometheus-handbook/assets/functions.html-hb2Jucud.js">
    <link rel="prefetch" href="/prometheus-handbook/assets/CONTRIBUTING.html-rsbQdJ8c.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-Z1cc0D3e.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/SUMMARY.html-8hbagXWA.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/overview.html-51mdUGIu.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/data_model.html-Yx60HKyT.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/metric_types.html-0YdtM_pH.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/api.html-GfNBJA6N.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/basics.html-fyOU033A.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/examples.html-i3ItTVsx.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/federation.html-2Uynx16M.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/gettingstarted.html-6gDnsBma.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/installation.html-6XMK7JP7.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/operators.html-YLI6DKoC.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/storage.html-x9U1dxVG.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/404.html-6qUJas5t.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-1ewu_Ya4.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-CcrIyzi3.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-PVTgtfnc.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/CONTRIBUTING.html-7DVpJ4bo.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-48TfvTB8.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/SUMMARY.html-CEmnRtVn.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/overview.html-TqDMDq6O.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/data_model.html-R6X5Zgpu.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/metric_types.html-2jXkiPT3.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/api.html-EqhmJ1h4.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/basics.html-4nRLPA4l.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/examples.html-TuL69zoY.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/federation.html-JEego1Xb.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/gettingstarted.html-RnSPcChE.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/installation.html-kFK_hTDF.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/operators.html-zCNXS_WR.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/storage.html-hDzVbwan.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/404.html-3EOO_Gat.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-B7flwh-3.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-b--5_puY.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/index.html-KopNuVcU.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/giscus-unEZQsJ0.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/photoswipe.esm-i2ohwMnJ.js" as="script"><link rel="prefetch" href="/prometheus-handbook/assets/SearchResult-7P-vEdYM.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/prometheus-handbook/"><img class="vp-nav-logo" src="/prometheus-handbook/avatar.webp" alt="prometheus-handbook"><!----><span class="vp-site-name hide-in-pad">prometheus-handbook</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="项目主页" class="vp-link nav-link nav-link" href="/prometheus-handbook/"><span class="font-icon icon fa-home fas" style=""></span>项目主页<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="开始阅读" class="vp-link nav-link nav-link" href="/prometheus-handbook/1-introduction/overview.html"><span class="font-icon icon fa-book fas" style=""></span>开始阅读<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="相关文档"><span class="title"><span class="font-icon icon fa-link fas" style=""></span>相关文档</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="https://prometheus.fuckcloudnative.io/" rel="noopener noreferrer" target="_blank" aria-label="https://prometheus.fuckcloudnative.io/" class="nav-link"><span class="font-icon icon fa-paper-plane fas" style=""></span>https://prometheus.fuckcloudnative.io/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/xszhu522/prometheus-handbook" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="项目主页" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/"><span class="font-icon icon fa-home fas" style=""></span>项目主页<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">第一章：介绍</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="第1节：Prometheus 简介" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/1-introduction/overview.html"><!---->第1节：Prometheus 简介<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">第二章：概念</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="第1节：数据模型" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/2-concepts/data_model.html"><!---->第1节：数据模型<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第2节：指标类型" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/2-concepts/metric_types.html"><!---->第2节：指标类型<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading active"><!----><span class="vp-sidebar-title">第三章：Prometheus</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">第1节：初识 Prometheus</span><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">第2节：安装</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">第3节：配置</span><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">第4节：查询</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a aria-label="初识 PromQL" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/3-prometheus/basics.html"><!---->初识 PromQL<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="操作符" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/3-prometheus/operators.html"><!---->操作符<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="PromQL 内置函数" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/prometheus-handbook/3-prometheus/functions.html"><!---->PromQL 内置函数<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="abs()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#abs"><!---->abs()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="absent()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#absent"><!---->absent()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="ceil()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#ceil"><!---->ceil()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="changes()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#changes"><!---->changes()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="clamp_max()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#clamp-max"><!---->clamp_max()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="clamp_min()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#clamp-min"><!---->clamp_min()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="day_of_month()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#day-of-month"><!---->day_of_month()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="day_of_week()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#day-of-week"><!---->day_of_week()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="days_in_month()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#days-in-month"><!---->days_in_month()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="delta()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#delta"><!---->delta()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="deriv()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#deriv"><!---->deriv()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="exp()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#exp"><!---->exp()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="floor()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#floor"><!---->floor()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="histogram_quantile()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#histogram-quantile"><!---->histogram_quantile()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="holt_winters()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#holt-winters"><!---->holt_winters()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="hour()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#hour"><!---->hour()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="idelta()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#idelta"><!---->idelta()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="increase()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#increase"><!---->increase()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="irate()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#irate"><!---->irate()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="label_join()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#label-join"><!---->label_join()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="label_replace()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#label-replace"><!---->label_replace()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="ln()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#ln"><!---->ln()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="log2()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#log2"><!---->log2()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="log10()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#log10"><!---->log10()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="minute()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#minute"><!---->minute()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="month()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#month"><!---->month()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="predict_linear()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#predict-linear"><!---->predict_linear()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="rate()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#rate"><!---->rate()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="resets()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#resets"><!---->resets()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="round()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#round"><!---->round()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="scalar()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#scalar"><!---->scalar()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="sort()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#sort"><!---->sort()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="sort_desc()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#sort-desc"><!---->sort_desc()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="sqrt()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#sqrt"><!---->sqrt()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="time()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#time"><!---->time()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="timestamp()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#timestamp"><!---->timestamp()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="vector()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#vector"><!---->vector()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="year()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#year"><!---->year()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="&lt;aggregation&gt;_over_time()" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/prometheus-handbook/3-prometheus/functions.html#aggregation-over-time"><!---->&lt;aggregation&gt;_over_time()<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-label="简单示例" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/3-prometheus/examples.html"><!---->简单示例<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="在 HTTP API 中使用 PromQL" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/3-prometheus/api.html"><!---->在 HTTP API 中使用 PromQL<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a aria-label="第5节：存储" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/3-prometheus/storage.html"><!---->第5节：存储<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第6节：联邦集群" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/prometheus-handbook/3-prometheus/federation.html"><!---->第6节：联邦集群<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->PromQL 内置函数</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://xszhu522.github.io" target="_blank" rel="noopener noreferrer">xszhu522</a></span><span property="author" content="xszhu522"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2019-03-29T07:30:29.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 13 分钟</span><meta property="timeRequired" content="PT13M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#abs">abs()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#absent">absent()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#ceil">ceil()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#changes">changes()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#clamp-max">clamp_max()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#clamp-min">clamp_min()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#day-of-month">day_of_month()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#day-of-week">day_of_week()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#days-in-month">days_in_month()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#delta">delta()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#deriv">deriv()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#exp">exp()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#floor">floor()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#histogram-quantile">histogram_quantile()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#holt-winters">holt_winters()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#hour">hour()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#idelta">idelta()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#increase">increase()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#irate">irate()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#label-join">label_join()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#label-replace">label_replace()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#ln">ln()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#log2">log2()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#log10">log10()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#minute">minute()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#month">month()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#predict-linear">predict_linear()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#rate">rate()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#resets">resets()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#round">round()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#scalar">scalar()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#sort">sort()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#sort-desc">sort_desc()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#sqrt">sqrt()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#time">time()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#timestamp">timestamp()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#vector">vector()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#year">year()</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#aggregation-over-time">&lt;aggregation&gt;_over_time()</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="promql-内置函数" tabindex="-1"><a class="header-anchor" href="#promql-内置函数" aria-hidden="true">#</a> PromQL 内置函数</h1><p>Prometheus 提供了其它大量的内置函数，可以对时序数据进行丰富的处理。某些函数有默认的参数，例如：<code>year(v=vector(time()) instant-vector)</code>。其中参数 <code>v</code> 是一个瞬时向量，如果不提供该参数，将使用默认值 <code>vector(time())</code>。instant-vector 表示参数类型。</p><h2 id="abs" tabindex="-1"><a class="header-anchor" href="#abs" aria-hidden="true">#</a> abs()</h2><p><code>abs(v instant-vector)</code> 返回输入向量的所有样本的绝对值。</p><h2 id="absent" tabindex="-1"><a class="header-anchor" href="#absent" aria-hidden="true">#</a> absent()</h2><p><code>absent(v instant-vector)</code>，如果传递给它的向量参数具有样本数据，则返回空向量；如果传递的向量参数没有样本数据，则返回不带度量指标名称且带有标签的时间序列，且样本值为1。</p><p>当监控度量指标时，如果获取到的样本数据是空的， 使用 absent 方法对告警是非常有用的。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 这里提供的向量有样本数据</span>
absent<span class="token punctuation">(</span>http_requests_total<span class="token punctuation">{</span>method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> no data
absent<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>http_requests_total<span class="token punctuation">{</span>method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span><span class="token punctuation">))</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> no data

<span class="token comment"># 由于不存在度量指标 nonexistent，所以 返回不带度量指标名称且带有标签的时间序列，且样本值为1</span>
absent<span class="token punctuation">(</span>nonexistent<span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">}</span>  <span class="token number">1</span>
<span class="token comment"># 正则匹配的 instance 不作为返回 labels 中的一部分</span>
absent<span class="token punctuation">(</span>nonexistent<span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;myjob&quot;</span>,instance<span class="token operator">=~</span><span class="token string">&quot;.*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">}</span>  <span class="token number">1</span>

<span class="token comment"># sum 函数返回的时间序列不带有标签，且没有样本数据</span>
absent<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>nonexistent<span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">}</span><span class="token punctuation">))</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ceil" tabindex="-1"><a class="header-anchor" href="#ceil" aria-hidden="true">#</a> ceil()</h2><p><code>ceil(v instant-vector)</code> 将 v 中所有元素的样本值向上四舍五入到最接近的整数。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>node_load5<span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;192.168.1.75:9100&quot;</span><span class="token punctuation">}</span> <span class="token comment"># 结果为 2.79</span>
ceil<span class="token punctuation">(</span>node_load5<span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;192.168.1.75:9100&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 结果为 3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="changes" tabindex="-1"><a class="header-anchor" href="#changes" aria-hidden="true">#</a> changes()</h2><p><code>changes(v range-vector)</code> 输入一个区间向量， 返回这个区间向量内每个样本数据值变化的次数（瞬时向量）。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 如果样本数据值没有发生变化，则返回结果为 1</span>
changes<span class="token punctuation">(</span>node_load5<span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;192.168.1.75:9100&quot;</span><span class="token punctuation">}</span><span class="token punctuation">[</span>1m<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 结果为 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="clamp-max" tabindex="-1"><a class="header-anchor" href="#clamp-max" aria-hidden="true">#</a> clamp_max()</h2><p><code>clamp_max(v instant-vector, max scalar)</code> 函数，输入一个瞬时向量和最大值，样本数据值若大于 max，则改为 max，否则不变。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>node_load5<span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;192.168.1.75:9100&quot;</span><span class="token punctuation">}</span> <span class="token comment"># 结果为 2.79</span>
clamp_max<span class="token punctuation">(</span>node_load5<span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;192.168.1.75:9100&quot;</span><span class="token punctuation">}</span>, <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 结果为 2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="clamp-min" tabindex="-1"><a class="header-anchor" href="#clamp-min" aria-hidden="true">#</a> clamp_min()</h2><p><code>clamp_min(v instant-vector, min scalar)</code> 函数，输入一个瞬时向量和最小值，样本数据值若小于 min，则改为 min，否则不变。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>node_load5<span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;192.168.1.75:9100&quot;</span><span class="token punctuation">}</span> <span class="token comment"># 结果为 2.79</span>
clamp_min<span class="token punctuation">(</span>node_load5<span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;192.168.1.75:9100&quot;</span><span class="token punctuation">}</span>, <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 结果为 3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="day-of-month" tabindex="-1"><a class="header-anchor" href="#day-of-month" aria-hidden="true">#</a> day_of_month()</h2><p><code>day_of_month(v=vector(time()) instant-vector)</code> 函数，返回被给定 UTC 时间所在月的第几天。返回值范围：1~31。</p><h2 id="day-of-week" tabindex="-1"><a class="header-anchor" href="#day-of-week" aria-hidden="true">#</a> day_of_week()</h2><p><code>day_of_week(v=vector(time()) instant-vector)</code> 函数，返回被给定 UTC 时间所在周的第几天。返回值范围：0~6，0 表示星期天。</p><h2 id="days-in-month" tabindex="-1"><a class="header-anchor" href="#days-in-month" aria-hidden="true">#</a> days_in_month()</h2><p><code>days_in_month(v=vector(time()) instant-vector)</code> 函数，返回当月一共有多少天。返回值范围：28~31。</p><h2 id="delta" tabindex="-1"><a class="header-anchor" href="#delta" aria-hidden="true">#</a> delta()</h2><p><code>delta(v range-vector)</code> 的参数是一个区间向量，返回一个瞬时向量。它计算一个区间向量 v 的第一个元素和最后一个元素之间的差值。由于这个值被外推到指定的整个时间范围，所以即使样本值都是整数，你仍然可能会得到一个非整数值。</p><p>例如，下面的例子返回过去两小时的 CPU 温度差：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>delta<span class="token punctuation">(</span>cpu_temp_celsius<span class="token punctuation">{</span>host<span class="token operator">=</span><span class="token string">&quot;zeus&quot;</span><span class="token punctuation">}</span><span class="token punctuation">[</span>2h<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="deriv" tabindex="-1"><a class="header-anchor" href="#deriv" aria-hidden="true">#</a> deriv()</h2><p><code>deriv(v range-vector)</code> 的参数是一个区间向量,返回一个瞬时向量。它使用<a href="http://en.wikipedia.org/wiki/Simple_linear_regression" target="_blank" rel="noopener noreferrer">简单的线性回归<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>计算区间向量 v 中各个时间序列的导数。</p><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="exp" tabindex="-1"><a class="header-anchor" href="#exp" aria-hidden="true">#</a> exp()</h2><p><code>exp(v instant-vector)</code> 函数，输入一个瞬时向量，返回各个样本值的 <code>e</code> 的指数值，即 e 的 N 次方。当 N 的值足够大时会返回 <code>+Inf</code>。特殊情况为：</p><ul><li><code>Exp(+Inf) = +Inf</code></li><li><code>Exp(NaN) = NaN</code></li></ul><h2 id="floor" tabindex="-1"><a class="header-anchor" href="#floor" aria-hidden="true">#</a> floor()</h2><p><code>floor(v instant-vector)</code> 函数与 ceil() 函数相反，将 v 中所有元素的样本值向下四舍五入到最接近的整数。</p><h2 id="histogram-quantile" tabindex="-1"><a class="header-anchor" href="#histogram-quantile" aria-hidden="true">#</a> histogram_quantile()</h2><p><code>histogram_quantile(φ float, b instant-vector)</code> 从 bucket 类型的向量 <code>b</code> 中计算 φ (0 ≤ φ ≤ 1) 分位数（百分位数的一般形式）的样本的最大值。（有关 φ 分位数的详细说明以及直方图指标类型的使用，请参阅<a href="https://prometheus.io/docs/practices/histograms" target="_blank" rel="noopener noreferrer">直方图和摘要<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）。向量 <code>b</code> 中的样本是每个 bucket 的采样点数量。每个样本的 labels 中必须要有 <code>le</code> 这个 label 来表示每个 bucket 的上边界，没有 <code>le</code> 标签的样本会被忽略。直方图指标类型自动提供带有 <code>_bucket</code> 后缀和相应标签的时间序列。</p><p>可以使用 <code>rate()</code> 函数来指定分位数计算的时间窗口。</p><p>例如，一个直方图指标名称为 <code>employee_age_bucket_bucket</code>，要计算过去 10 分钟内 第 90 个百分位数，请使用以下表达式：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>histogram_quantile<span class="token punctuation">(</span><span class="token number">0.9</span>, rate<span class="token punctuation">(</span>employee_age_bucket_bucket<span class="token punctuation">[</span>10m<span class="token punctuation">]</span><span class="token punctuation">))</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>返回：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">{</span>instance<span class="token operator">=</span><span class="token string">&quot;10.0.86.71:8080&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span><span class="token punctuation">}</span> <span class="token number">35.714285714285715</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这表示最近 10 分钟之内 90% 的样本的最大值为 35.714285714285715。</p><p>这个计算结果是每组标签组合成一个时间序列。我们可能不会对所有这些维度（如 <code>job</code>、<code>instance</code> 和 <code>method</code>）感兴趣，并希望将其中的一些维度进行聚合，则可以使用 sum() 函数。例如，以下表达式根据 <code>job</code> 标签来对第 90 个百分位数进行聚合：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># histogram_quantile() 函数必须包含 le 标签</span>
histogram_quantile<span class="token punctuation">(</span><span class="token number">0.9</span>, sum<span class="token punctuation">(</span>rate<span class="token punctuation">(</span>employee_age_bucket_bucket<span class="token punctuation">[</span>10m<span class="token punctuation">]</span><span class="token punctuation">))</span> by <span class="token punctuation">(</span>job, le<span class="token punctuation">))</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果要聚合所有的标签，则使用如下表达式：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>histogram_quantile<span class="token punctuation">(</span><span class="token number">0.9</span>,sum<span class="token punctuation">(</span>rate<span class="token punctuation">(</span>employee_age_bucket_bucket<span class="token punctuation">[</span>10m<span class="token punctuation">]</span><span class="token punctuation">))</span> by <span class="token punctuation">(</span>le<span class="token punctuation">))</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><blockquote><p><strong>[info] 注意</strong></p><p><code>histogram_quantile</code> 这个函数是根据假定每个区间内的样本分布是线性分布来计算结果值的(也就是说它的结果未必准确)，最高的 bucket 必须是 le=&quot;+Inf&quot; (否则就返回 NaN)。</p><p>如果分位数位于最高的 bucket（+Inf） 中，则返回第二个最高的 bucket 的上边界。如果该 bucket 的上边界大于 0，则假设最低的 bucket 的的下边界为 0，这种情况下在该 bucket 内使用常规的线性插值。</p><p>如果分位数位于最低的 bucket 中，则返回最低 bucket 的上边界。</p></blockquote><p>如果 b 含有少于 2 个 buckets，那么会返回 <code>NaN</code>，如果 φ &lt; 0 会返回 <code>-Inf</code>，如果 φ &gt; 1 会返回 <code>+Inf</code>。</p><h2 id="holt-winters" tabindex="-1"><a class="header-anchor" href="#holt-winters" aria-hidden="true">#</a> holt_winters()</h2><p><code>holt_winters(v range-vector, sf scalar, tf scalar)</code> 函数基于区间向量 v，生成时间序列数据平滑值。平滑因子 <code>sf</code> 越低, 对旧数据的重视程度越高。趋势因子 <code>tf</code> 越高，对数据的趋势的考虑就越多。其中，<code>0&lt; sf, tf &lt;=1</code>。</p><p>holt_winters 仅适用于 Gauge 类型的时间序列。</p><h2 id="hour" tabindex="-1"><a class="header-anchor" href="#hour" aria-hidden="true">#</a> hour()</h2><p><code>hour(v=vector(time()) instant-vector)</code> 函数返回被给定 UTC 时间的当前第几个小时，时间范围：0~23。</p><h2 id="idelta" tabindex="-1"><a class="header-anchor" href="#idelta" aria-hidden="true">#</a> idelta()</h2><p>idelta(v range-vector) 的参数是一个区间向量, 返回一个瞬时向量。它计算最新的 2 个样本值之间的差值。</p><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="increase" tabindex="-1"><a class="header-anchor" href="#increase" aria-hidden="true">#</a> increase()</h2><p><code>increase(v range-vector)</code> 函数获取区间向量中的第一个和最后一个样本并返回其增长量, 它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。由于这个值被外推到指定的整个时间范围，所以即使样本值都是整数，你仍然可能会得到一个非整数值。</p><p>例如，以下表达式返回区间向量中每个时间序列过去 5 分钟内 HTTP 请求数的增长数：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>increase<span class="token punctuation">(</span>http_requests_total<span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;apiserver&quot;</span><span class="token punctuation">}</span><span class="token punctuation">[</span>5m<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>increase</code> 的返回值类型只能是计数器类型，主要作用是增加图表和数据的可读性。使用 <code>rate</code> 函数记录规则的使用率，以便持续跟踪数据样本值的变化。</p><h2 id="irate" tabindex="-1"><a class="header-anchor" href="#irate" aria-hidden="true">#</a> irate()</h2><p><code>irate(v range-vector)</code> 函数用于计算区间向量的增长率，但是其反应出的是瞬时增长率。irate 函数是通过区间向量中最后两个两本数据来计算区间向量的增长速率，它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。这种方式可以避免在时间窗口范围内的“长尾问题”，并且体现出更好的灵敏度，通过irate函数绘制的图标能够更好的反应样本数据的瞬时变化状态。</p><p>例如，以下表达式返回区间向量中每个时间序列过去 5 分钟内最后两个样本数据的 HTTP 请求数的增长率：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>irate<span class="token punctuation">(</span>http_requests_total<span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;api-server&quot;</span><span class="token punctuation">}</span><span class="token punctuation">[</span>5m<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>irate 只能用于绘制快速变化的计数器，在长期趋势分析或者告警中更推荐使用 rate 函数。因为使用 irate 函数时，速率的简短变化会重置 <code>FOR</code> 语句，形成的图形有很多波峰，难以阅读。</p><blockquote><p><strong>[info] 注意</strong></p><p>当将 <code>irate()</code> 函数与<a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators" target="_blank" rel="noopener noreferrer">聚合运算符<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（例如 <code>sum()</code>）或随时间聚合的函数（任何以 <code>_over_time</code> 结尾的函数）一起使用时，必须先执行 irate 函数，然后再进行聚合操作，否则当采样目标重新启动时 irate() 无法检测到计数器是否被重置。</p></blockquote><h2 id="label-join" tabindex="-1"><a class="header-anchor" href="#label-join" aria-hidden="true">#</a> label_join()</h2><p><code>label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)</code> 函数可以将时间序列 v 中多个标签 <code>src_label</code> 的值，通过 <code>separator</code> 作为连接符写入到一个新的标签 <code>dst_label</code> 中。可以有多个 src_label 标签。</p><p>例如，以下表达式返回的时间序列多了一个 <code>foo</code> 标签，标签值为 <code>etcd,etcd-k8s</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>up<span class="token punctuation">{</span>endpoint<span class="token operator">=</span><span class="token string">&quot;api&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;192.168.123.248:2379&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;etcd&quot;</span>,namespace<span class="token operator">=</span><span class="token string">&quot;monitoring&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;etcd-k8s&quot;</span><span class="token punctuation">}</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> up<span class="token punctuation">{</span>endpoint<span class="token operator">=</span><span class="token string">&quot;api&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;192.168.123.248:2379&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;etcd&quot;</span>,namespace<span class="token operator">=</span><span class="token string">&quot;monitoring&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;etcd-k8s&quot;</span><span class="token punctuation">}</span>  <span class="token number">1</span>

label_join<span class="token punctuation">(</span>up<span class="token punctuation">{</span>endpoint<span class="token operator">=</span><span class="token string">&quot;api&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;192.168.123.248:2379&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;etcd&quot;</span>,namespace<span class="token operator">=</span><span class="token string">&quot;monitoring&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;etcd-k8s&quot;</span><span class="token punctuation">}</span>, <span class="token string">&quot;foo&quot;</span>, <span class="token string">&quot;,&quot;</span>, <span class="token string">&quot;job&quot;</span>, <span class="token string">&quot;service&quot;</span><span class="token punctuation">)</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> up<span class="token punctuation">{</span>endpoint<span class="token operator">=</span><span class="token string">&quot;api&quot;</span>,foo<span class="token operator">=</span><span class="token string">&quot;etcd,etcd-k8s&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;192.168.123.248:2379&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;etcd&quot;</span>,namespace<span class="token operator">=</span><span class="token string">&quot;monitoring&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;etcd-k8s&quot;</span><span class="token punctuation">}</span>  <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="label-replace" tabindex="-1"><a class="header-anchor" href="#label-replace" aria-hidden="true">#</a> label_replace()</h2><p>为了能够让客户端的图标更具有可读性，可以通过 <code>label_replace</code> 函数为时间序列添加额外的标签。label_replace 的具体参数如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>label_replace<span class="token punctuation">(</span>v instant-vector, dst_label string, replacement string, src_label string, regex string<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>该函数会依次对 v 中的每一条时间序列进行处理，通过 <code>regex</code> 匹配 src_label 的值，并将匹配部分 <code>relacement</code> 写入到 dst_label 标签中。如下所示：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>label_replace<span class="token punctuation">(</span>up, <span class="token string">&quot;host&quot;</span>, <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>, <span class="token string">&quot;instance&quot;</span>,  <span class="token string">&quot;(.*):.*&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>函数处理后，时间序列将包含一个 <code>host</code> 标签，host 标签的值为 Exporter 实例的 IP 地址：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>up<span class="token punctuation">{</span>host<span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;localhost:8080&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;cadvisor&quot;</span><span class="token punctuation">}</span>   <span class="token number">1</span>
up<span class="token punctuation">{</span>host<span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;localhost:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span><span class="token punctuation">}</span>   <span class="token number">1</span>
up<span class="token punctuation">{</span>host<span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;localhost:9100&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">}</span>   <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ln" tabindex="-1"><a class="header-anchor" href="#ln" aria-hidden="true">#</a> ln()</h2><p><code>ln(v instant-vector)</code> 计算瞬时向量 v 中所有样本数据的自然对数。特殊情况：</p><ul><li><code>ln(+Inf) = +Inf</code></li><li><code>ln(0) = -Inf</code></li><li><code>ln(x &lt; 0) = NaN</code></li><li><code>ln(NaN) = NaN</code></li></ul><h2 id="log2" tabindex="-1"><a class="header-anchor" href="#log2" aria-hidden="true">#</a> log2()</h2><p><code>log2(v instant-vector)</code> 函数计算瞬时向量 v 中所有样本数据的二进制对数。特殊情况同上。</p><h2 id="log10" tabindex="-1"><a class="header-anchor" href="#log10" aria-hidden="true">#</a> log10()</h2><p><code>log10(v instant-vector)</code> 计算瞬时向量 v 中所有样本数据的十进制对数。特殊情况同上。</p><h2 id="minute" tabindex="-1"><a class="header-anchor" href="#minute" aria-hidden="true">#</a> minute()</h2><p><code>minute(v=vector(time()) instant-vector)</code> 函数返回给定 UTC 时间当前小时的第多少分钟。结果范围：0~59。</p><h2 id="month" tabindex="-1"><a class="header-anchor" href="#month" aria-hidden="true">#</a> month()</h2><p><code>month(v=vector(time()) instant-vector)</code> 函数返回给定 UTC 时间当前属于第几个月，结果范围：0~12。</p><h2 id="predict-linear" tabindex="-1"><a class="header-anchor" href="#predict-linear" aria-hidden="true">#</a> predict_linear()</h2><p><code>predict_linear(v range-vector, t scalar)</code> 函数可以预测时间序列 v 在 t 秒后的值。它基于简单线性回归的方式，对时间窗口内的样本数据进行统计，从而可以对时间序列的变化趋势做出预测。该函数的返回结果<strong>不带有度量指标</strong>，只有标签列表。</p><p>例如，基于 2 小时的样本数据，来预测主机可用磁盘空间的是否在 4 个小时候被占满，可以使用如下表达式：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>predict_linear<span class="token punctuation">(</span>node_filesystem_free<span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">}</span><span class="token punctuation">[</span>2h<span class="token punctuation">]</span>, <span class="token number">4</span> * <span class="token number">3600</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通过下面的例子来观察返回值：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>predict_linear<span class="token punctuation">(</span>http_requests_total<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">&quot;200&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;120.77.65.193:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span><span class="token punctuation">[</span>5m<span class="token punctuation">]</span>, <span class="token number">5</span><span class="token punctuation">)</span>
结果：
<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">&quot;200&quot;</span>,handler<span class="token operator">=</span><span class="token string">&quot;query_range&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;120.77.65.193:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span>  <span class="token number">1</span>
<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">&quot;200&quot;</span>,handler<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;120.77.65.193:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span>   <span class="token number">4283.449995397104</span>
<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">&quot;200&quot;</span>,handler<span class="token operator">=</span><span class="token string">&quot;static&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;120.77.65.193:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span>   <span class="token number">22.99999999999999</span>
<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="rate" tabindex="-1"><a class="header-anchor" href="#rate" aria-hidden="true">#</a> rate()</h2><p><code>rate(v range-vector)</code> 函数可以直接计算区间向量 v 在时间窗口内平均增长速率，它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。该函数的返回结果<strong>不带有度量指标</strong>，只有标签列表。</p><p>例如，以下表达式返回区间向量中每个时间序列过去 5 分钟内 HTTP 请求数的每秒增长率：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rate<span class="token punctuation">(</span>http_requests_total<span class="token punctuation">[</span>5m<span class="token punctuation">]</span><span class="token punctuation">)</span>
结果：
<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">&quot;200&quot;</span>,handler<span class="token operator">=</span><span class="token string">&quot;label_values&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;120.77.65.193:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span> <span class="token number">0</span>
<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">&quot;200&quot;</span>,handler<span class="token operator">=</span><span class="token string">&quot;query_range&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;120.77.65.193:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span>  <span class="token number">0</span>
<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">&quot;200&quot;</span>,handler<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,instance<span class="token operator">=</span><span class="token string">&quot;120.77.65.193:9090&quot;</span>,job<span class="token operator">=</span><span class="token string">&quot;prometheus&quot;</span>,method<span class="token operator">=</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span>   <span class="token number">0.2</span>
<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>rate() 函数返回值类型只能用计数器，在长期趋势分析或者告警中推荐使用这个函数。</p><blockquote><p><strong>[info] 注意</strong></p><p>当将 <code>rate()</code> 函数与<a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators" target="_blank" rel="noopener noreferrer">聚合运算符<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（例如 <code>sum()</code>）或随时间聚合的函数（任何以 <code>_over_time</code> 结尾的函数）一起使用时，必须先执行 rate 函数，然后再进行聚合操作，否则当采样目标重新启动时 rate() 无法检测到计数器是否被重置。</p></blockquote><h2 id="resets" tabindex="-1"><a class="header-anchor" href="#resets" aria-hidden="true">#</a> resets()</h2><p><code>resets(v range-vector)</code> 的参数是一个区间向量。对于每个时间序列，它都返回一个计数器重置的次数。两个连续样本之间的值的减少被认为是一次计数器重置。</p><p>这个函数一般只用在计数器类型的时间序列上。</p><h2 id="round" tabindex="-1"><a class="header-anchor" href="#round" aria-hidden="true">#</a> round()</h2><p><code>round(v instant-vector, to_nearest=1 scalar)</code> 函数与 <code>ceil</code> 和 <code>floor</code> 函数类似，返回向量中所有样本值的最接近的整数。<code>to_nearest</code> 参数是可选的,默认为 1,表示样本返回的是最接近 1 的整数倍的值。你也可以将该参数指定为任意值（也可以是小数），表示样本返回的是最接近它的整数倍的值。</p><h2 id="scalar" tabindex="-1"><a class="header-anchor" href="#scalar" aria-hidden="true">#</a> scalar()</h2><p><code>scalar(v instant-vector)</code> 函数的参数是一个单元素的瞬时向量,它返回其唯一的时间序列的值作为一个标量。如果度量指标的样本数量大于 1 或者等于 0, 则返回 <code>NaN</code>。</p><h2 id="sort" tabindex="-1"><a class="header-anchor" href="#sort" aria-hidden="true">#</a> sort()</h2><p><code>sort(v instant-vector)</code> 函数对向量按元素的值进行升序排序，返回结果：key: value = 度量指标：样本值[升序排列]。</p><h2 id="sort-desc" tabindex="-1"><a class="header-anchor" href="#sort-desc" aria-hidden="true">#</a> sort_desc()</h2><p><code>sort(v instant-vector)</code> 函数对向量按元素的值进行降序排序，返回结果：key: value = 度量指标：样本值[降序排列]。</p><h2 id="sqrt" tabindex="-1"><a class="header-anchor" href="#sqrt" aria-hidden="true">#</a> sqrt()</h2><p><code>sqrt(v instant-vector)</code> 函数计算向量 v 中所有元素的平方根。</p><h2 id="time" tabindex="-1"><a class="header-anchor" href="#time" aria-hidden="true">#</a> time()</h2><p><code>time()</code> 函数返回从 1970-01-01 到现在的秒数。注意：它不是直接返回当前时间，而是时间戳</p><h2 id="timestamp" tabindex="-1"><a class="header-anchor" href="#timestamp" aria-hidden="true">#</a> timestamp()</h2><p><code>timestamp(v instant-vector)</code> 函数返回向量 v 中的每个样本的时间戳（从 1970-01-01 到现在的秒数）。</p><p>该函数从 Prometheus 2.0 版本开始引入。</p><h2 id="vector" tabindex="-1"><a class="header-anchor" href="#vector" aria-hidden="true">#</a> vector()</h2><p><code>vector(s scalar)</code> 函数将标量 s 作为没有标签的向量返回，即返回结果为：key: value= {}, s。</p><h2 id="year" tabindex="-1"><a class="header-anchor" href="#year" aria-hidden="true">#</a> year()</h2><p><code>year(v=vector(time()) instant-vector)</code> 函数返回被给定 UTC 时间的当前年份。</p><h2 id="aggregation-over-time" tabindex="-1"><a class="header-anchor" href="#aggregation-over-time" aria-hidden="true">#</a> <code>&lt;aggregation&gt;_over_time()</code></h2><p>下面的函数列表允许传入一个区间向量，它们会聚合每个时间序列的范围，并返回一个瞬时向量：</p><ul><li><code>avg_over_time(range-vector)</code> : 区间向量内每个度量指标的平均值。</li><li><code>min_over_time(range-vector)</code> : 区间向量内每个度量指标的最小值。</li><li><code>max_over_time(range-vector)</code> : 区间向量内每个度量指标的最大值。</li><li><code>sum_over_time(range-vector)</code> : 区间向量内每个度量指标的求和。</li><li><code>count_over_time(range-vector)</code> : 区间向量内每个度量指标的样本数据个数。</li><li><code>quantile_over_time(scalar, range-vector)</code> : 区间向量内每个度量指标的样本数据值分位数，φ-quantile (0 ≤ φ ≤ 1)。</li><li><code>stddev_over_time(range-vector)</code> : 区间向量内每个度量指标的总体标准差。</li><li><code>stdvar_over_time(range-vector)</code> : 区间向量内每个度量指标的总体标准方差。</li></ul><blockquote><p><strong>[info] 注意</strong></p><p>即使区间向量内的值分布不均匀，它们在聚合时的权重也是相同的。</p></blockquote></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/xszhu522/prometheus-handbook/edit/vuepress-theme-hope/3-prometheus/functions.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: yangchuansheng33@gmail.com">yangchuansheng</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a aria-label="操作符" class="vp-link nav-link prev nav-link prev" href="/prometheus-handbook/3-prometheus/operators.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->操作符</div></a><a aria-label="简单示例" class="vp-link nav-link next nav-link next" href="/prometheus-handbook/3-prometheus/examples.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">简单示例<!----></div></a></nav><div id="comment" class="giscus-wrapper input-top" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright © 2023 xszhu522</div></footer></div><!--]--><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/prometheus-handbook/assets/app-aeozbcr_.js" defer></script>
  </body>
</html>
